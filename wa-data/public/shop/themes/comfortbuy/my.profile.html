<div class="content">

    <!-- navigation breadcrumbs -->
    <div class="breadcrumbs">
        <a href="{$wa_app_url}">[`Home`]</a> » <a href="{$wa->getUrl('/frontend/my')}">[`My Account`]</a> » <span class="gray">[`My profile`]</span>
    </div>
    
    <div class="info-page menu">{$wa->myNav()}</div>

    <h1>[`My profile`]</h1>
    
    {if $saved}
        <strong><i class="icon16 saved"></i><span style="color: green;">[`Contact information successfully updated!`]</span></strong>
    {/if}
    
    <form action="" method="post">
    <div class="wa-form">
    
        {$form->html()}
    
        <div class="wa-field">
            <div class="wa-value">
                <input type="submit" value="[`Save`]">
            </div>
        </div>
    </div>
    </form>

</div>

<script type="text/javascript">
	$( ".wa-field-my_sizes-size_top" ).addClass('clearfix');
	$( ".wa-field-fav_color, .wa-field-hobbies, .wa-field-pets, .wa-field-cloth_brands, .wa-field-shoe_brands, .wa-field-cosmetic_shops, .wa-field-grocery_stores" ).each(function(){ multiField(this); });	
	$( ".wa-field-fav_style" ).each(function(){ multiSelectField(this); });	
	
	function addField(href) {
		var p = $('p', $(href).parent()).last();
		var input = $('input', p);
		if ($(input).val()=='') {
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300);
			return false;
		}
		var last_index = -1;
		var fname = $(input).attr('name');
		if (fname.indexOf("][") > -1) {
			last_index = fname.slice(fname.lastIndexOf("][")+2, fname.lastIndexOf("]"));
		}
		
		if (last_index == -1) {
			last_index = 0;
			input.attr('name', fname + '[0]');
		}
		
		last_index++;
		$(p).before($(p).clone());
		input.attr('value', '');
		input.focus();
		fname = $(input).attr('name').slice(0,-3);
		input.attr('name', fname + '[' + last_index + ']');
	}
	
	function addSelectField(href) {
		var p = $('p', $(href).parent()).last();
		var input = $('select', p);
		if ($(input).val()=='') {
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300);
			return false;
		}
		var last_index = -1;
		var fname = $(input).attr('name');
		if (fname.indexOf("][") > -1) {
			last_index = fname.slice(fname.lastIndexOf("][")+2, fname.lastIndexOf("]"));
		}
		
		if (last_index == -1) {
			last_index = 0;
			input.attr('name', fname + '[0]');
		}
		
		last_index++;
		$(p).before($(p).clone());
		input.attr('value', '');
		input.focus();
		fname = $(input).attr('name').slice(0,-3);
		input.attr('name', fname + '[' + last_index + ']');
	}
	
	function removeField(href) {
		var p = $(href).parent();
		var wa_value = $(p).parent();
		var other_ps = $(p).siblings('p');
		if (other_ps.length == 0) {
			var input = $('input', p);
			input.attr('value', '');
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300)
			return false;
		}

		p.remove();
		enumerateInputs(wa_value);
	}
	
	function enumerateInputs(wa_value) {
		var i = 0;
		var inputs = $('input', wa_value);
		inputs.each(function(){
			fname = $(this).attr('name').slice(0,-3);
			$(this).attr('name', fname + '[' + i + ']');
			if( $(this).val()=='' ) {
				$(this).parent().remove();
				i--;
			}
			i++;
		})
	}
	
	function multiField(field) {
		var wa_value = $('.wa-value', field).first();
		var inputs = $('input', wa_value);
		var last_input = $('input', wa_value).last();
		
		wa_value.append('<a onclick="addField(this);">добавить поле</a>');

		inputs.each(function(){
			$(this).before('<a style="float:right;" onclick="removeField(this);"><i class="icon-remove"></i></a>')
		});
	}

	function multiSelectField(field) {
		var wa_value = $('.wa-value', field).first();
		var inputs = $('select', wa_value);
		var last_input = $('input', wa_value).last();
		
		wa_value.append('<a onclick="addSelectField(this);">добавить поле</a>');

		inputs.each(function(){
			$(this).before('<a style="float:right;" onclick="removeField(this);"><i class="icon-remove"></i></a>')
		});
	}
	
</script>
