<script src="/wa-content/js/jquery-ui/jquery.ui.dialog.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="/wa-content/css/jquery-ui/ui-lightness/jquery-ui-1.8.2.custom.css">
<div class="content">
    <!-- navigation breadcrumbs -->
    <div class="breadcrumbs">
        <a href="{$wa_app_url}">[`Home`]</a> » <a href="{$wa->getUrl('/frontend/my')}">[`My Account`]</a> » <span class="gray">[`My profile`]</span>
    </div>
    
    <div class="info-page menu">{$wa->myNav()}</div>

    <h1>[`My profile`]</h1>
    
    {if $saved}
        <strong><i class="icon16 saved"></i><span style="color: green;">[`Contact information successfully updated!`]</span></strong>
    {/if}
    
	<div style="float:right; width:420px;">
    <form id="my-sizes-custom">
<div class="wa-form"><!-- размеры --><div class="wa-field wa-field-my_sizes"><div class="wa-name">Мои размеры</div><div class="wa-value"><span class="field wa-field-my_sizes-size_top clearfix"><span>Верх</span><select name="size_top"><option value=""></option><option value="40">40</option><option value="42">42</option><option value="44">44</option><option value="46">46</option><option value="48">48</option><option value="50">50</option><option value="52">52</option></select></span><span class="field wa-field-my_sizes-size_low"><span>Низ</span><select name="size_low"><option value=""></option><option value="42">42</option><option value="44">44</option><option value="46">46</option><option value="48">48</option><option value="50">50</option></select></span></div></div><!--/ форма --></div>
    </form>
	
    <div id="fav-style-custom">
		<div class="wa-form">
			<div class="wa-field wa-field-my_sela_shops">
				<div class="wa-name">Мои Магазины</div>
				<div class="wa-value">
					<ol id="contact-shop-list" class="shops-list" style="margin-left:-30px; margin-top: 0px;">
						{$contact->get(sela_shop)}
					</ol>
				</div>
				<div id="my-sela-shops-dialog" title="Мои магазины">
					<label for="country">Страна</label>
				    <select name="country" id="dialog-country">
						<option value="1" selected="selected">Россия</option>
						<option value="2">Украина</option>
						<option value="3">Беларусь</option>
<!-- 						<option value="4">Грузия</option> -->
						<option value="5">Казахстан</option>
						<option value="8">Молдова</option>
						<option value="10">Армения</option>
						<option value="18">Кыргызстан</option>
				    </select>
					<label for="city">Город</label>
					<select name="city" id="dialog-city"><option value="619">Москва</option>
						<option value="53">Абакан</option>
						<option value="513">Алушта</option>
						<option value="568">Анапа</option>
						<option value="566">Ангарск</option>
						<option value="31">Армавир</option>
						<option value="570">Арсеньев</option>
						<option value="2">Архангельск</option>
						<option value="483">Асбест</option>
						<option value="32">Астрахань</option>
						<option value="33">Ахтубинск</option>
						<option value="54">Ачинск</option>
						<option value="279">Балаково</option>
						<option value="113">Балашиха</option>
						<option value="647">Балашов</option>
						<option value="55">Барнаул</option>
						<option value="172">Березники</option>
						<option value="208">Березовский</option>
						<option value="324">Биробиджан</option>
						<option value="127">Благовещенск</option>
						<option value="402">Бор</option>
						<option value="259">Бугульма</option>
						<option value="3">Великие Луки</option>
						<option value="10">Великий Новгород</option>
						<option value="212">Верхняя Пышма</option>
						<option value="505">Верхняя Салда</option>
						<option value="128">Владивосток</option>
						<option value="34">Владикавказ</option>
						<option value="85">Владимир</option>
						<option value="35">Волгоград</option>
						<option value="36">Волгодонск</option>
						<option value="4">Вологда</option>
						<option value="648">Волоколамск</option>
						<option value="5">Воркута</option>
						<option value="86">Воронеж</option>
						<option value="636">Всеволожск</option>
						<option value="280">Вуктыл</option>
						<option value="469">Выборг</option>
						<option value="655">Вязьма</option>
						<option value="467">Гатчина</option>
						<option value="460">Геленджик</option>
						<option value="549">Гусь-Хрустальный</option>
						<option value="527">Дальнегорск</option>
						<option value="140">Дзержинск</option>
						<option value="142">Димитровград</option>
						<option value="514">Долгопрудный</option>
						<option value="107">Дубна</option>
						<option value="173">Екатеринбург</option>
						<option value="141">Елабуга</option>
						<option value="50">Ессентуки</option>
						<option value="114">Железнодорожный</option>
						<option value="591">Жуковский</option>
						<option value="169">Заволжье</option>
						<option value="532">Заречный</option>
						<option value="444">Зеленоград</option>
						<option value="175">Златоуст</option>
						<option value="87">Иваново</option>
						<option value="143">Ижевск</option>
						<option value="59">Иркутск</option>
						<option value="116">Истра</option>
						<option value="144">Йошкар-Ола</option>
						<option value="145">Казань</option>
						<option value="6">Калининград</option>
						<option value="88">Калуга</option>
						<option value="204">Каменск-Уральский</option>
						<option value="60">Кемерово</option>
						<option value="8">Кемь</option>
						<option value="604">Кингисепп</option>
						<option value="281">Кинешма</option>
						<option value="146">Киров</option>
						<option value="440">Кисловодск</option>
						<option value="110">Клин</option>
						<option value="637">Ковдор</option>
						<option value="494">Ковров</option>
						<option value="650">Когалым</option>
						<option value="644">Колпино</option>
						<option value="201">Коркино</option>
						<option value="118">Королев</option>
						<option value="89">Кострома</option>
						<option value="126">Красногорск</option>
						<option value="38">Краснодар</option>
						<option value="638">Красное Село</option>
						<option value="177">Краснотурьинск</option>
						<option value="569">Красноуфимск</option>
						<option value="61">Красноярск</option>
						<option value="472">Кронштадт</option>
						<option value="166">Кузнецк</option>
						<option value="178">Курган</option>
						<option value="111">Курск</option>
						<option value="62">Кызыл</option>
						<option value="283">Лениногорск</option>
						<option value="509">Лиски</option>
						<option value="27">Луга</option>
						<option value="407">Люберцы</option>
						<option value="39">Майкоп</option>
						<option value="307">Махачкала</option>
						<option value="203">Мегион</option>
						<option value="63">Междуреченск</option>
						<option value="181">Миасс</option>
						<option value="52">Минеральные Воды</option>
						<option value="9">Мурманск</option>
						<option value="285">Муром</option>
						<option value="526">Мытищи</option>
						<option value="148">Набережные челны</option>
						<option value="615">Надым</option>
						<option value="408">Назрань</option>
						<option value="64">Нарьян-Мар</option>
						<option value="149">Нефтекамск</option>
						<option value="567">Нефтеюганск</option>
						<option value="182">Нижневартовск</option>
						<option value="409">Нижнекамск</option>
						<option value="632">Нижнеудинск</option>
						<option value="151">Нижний Новгород</option>
						<option value="183">Нижний Тагил</option>
						<option value="448">Новозыбков</option>
						<option value="65">Новокузнецк</option>
						<option value="449">Новокуйбышевск</option>
						<option value="40">Новороссийск</option>
						<option value="66">Новосибирск</option>
						<option value="184">Новоуральск</option>
						<option value="605">Новочебоксарск</option>
						<option value="288">Новочеркасск</option>
						<option value="436">Новый Уренгой</option>
						<option value="301">Ногинск</option>
						<option value="186">Ноябрьск</option>
						<option value="510">Нягань</option>
						<option value="607">Одинцово</option>
						<option value="11">Озерск</option>
						<option value="418">Октябрьский</option>
						<option value="67">Омск</option>
						<option value="153">Оренбург</option>
						<option value="154">Пенза</option>
						<option value="188">Первоуральск</option>
						<option value="544">Переславль-Залесский</option>
						<option value="450">Пермь</option>
						<option value="12">Петрозаводск</option>
						<option value="493">Печора</option>
						<option value="13">Псков</option>
						<option value="484">Пушкин</option>
						<option value="191">Пыть-Ях</option>
						<option value="41">Пятигорск</option>
						<option value="120">Раменское</option>
						<option value="192">Ревда</option>
						<option value="639">Реутов</option>
						<option value="92">Россошь</option>
						<option value="42">Ростов-на-Дону</option>
						<option value="603">Ртищево</option>
						<option value="93">Рязань</option>
						<option value="155">Салават</option>
						<option value="156">Самара</option>
						<option value="1">Санкт-Петербург</option>
						<option value="158">Саратов</option>
						<option value="617">Саров</option>
						<option value="223">Севастополь</option>
						<option value="14">Северодвинск</option>
						<option value="194">Серов</option>
						<option value="95">Смоленск</option>
						<option value="168">Соликамск</option>
						<option value="654">Сортавала</option>
						<option value="471">Сосновый Бор</option>
						<option value="43">Сочи</option>
						<option value="45">Ставрополь</option>
						<option value="122">Ступино</option>
						<option value="195">Сургут</option>
						<option value="205">Сухой Лог</option>
						<option value="46">Таганрог</option>
						<option value="98">Тверь</option>
						<option value="333">Тимашевск</option>
						<option value="419">Тобольск</option>
						<option value="162">Тольятти</option>
						<option value="70">Томск</option>
						<option value="209">Трехгорный</option>
						<option value="202">Троицк</option>
						<option value="99">Тула</option>
						<option value="71">Тюмень</option>
						<option value="415">Ульяновск</option>
						<option value="196">Урай</option>
						<option value="16">Усинск</option>
						<option value="416">Уссурийск</option>
						<option value="478">Усть-Кут</option>
						<option value="164">Уфа</option>
						<option value="273">Феодосия</option>
						<option value="131">Хабаровск</option>
						<option value="135">Ханты-Мансийск</option>
						<option value="197">Чайковский</option>
						<option value="165">Чебоксары</option>
						<option value="198">Челябинск</option>
						<option value="18">Череповец</option>
						<option value="199">Шадринск</option>
						<option value="303">Щелково</option>
						<option value="304">Электросталь</option>
						<option value="49">Элиста</option>
						<option value="499">Югорск</option>
						<option value="133">Южно-Сахалинск</option>
						<option value="130">Якутск</option>
						<option value="643">Ялта</option>
						<option value="528">Янаул</option>
					</select>
					<div id="dialig-shop-list">
						<ul class="shop-list">
						</ul>
					</div>
				</div>
				<button id="opener">Выбрать</button>
			</div>
		</div>
    </div>
<script>
$(function() {
	$( "#my-sela-shops-dialog" ).dialog({
	  autoOpen: false,
	  show: {
	    effect: "blind",
	    duration: 100
	  },
	  hide: {
	    effect: "explode",
	    duration: 1000
	  },
	  width: '50%'
	});
	
	$( "#opener" ).click(function() {
	  $( "#my-sela-shops-dialog" ).dialog( "open" );
	  $( "#dialog-city" ).trigger( 'change' );
	});
	
	$( "#dialog-country" ).change(function(){
        var country=$("#dialog-country").val();
        $.ajax({
            url: '/index.php?module=bstfprofile&action=selaCities',
            dataType: 'json',
            data: {
	            country: country
            },
            success: function (response) {
				$('#dialog-city').html(response.data);
				$( "#dialog-city" ).trigger( 'change' );
            }
        });
    });
	
	$( "#dialog-city" ).change(function(){
        var city=$("#dialog-city").val();
        $.ajax({
            url: '/index.php?module=bstfprofile&action=selaShops',
            dataType: 'json',
            data: {
	            city: city
            },
            success: function (response) {
	            var shops = response.data;
	            $('#dialig-shop-list .shop-list').html('');
	            shops.forEach(function(item){
					shop = '<li><button onclick="contactAddShop(' + item.id + ');" style="display:inline-block;">+</button>' + item.address + '</li>';
					$('#dialig-shop-list .shop-list').append(shop);
	            });
            }
        });
    });
	
	var sela_shops = $('#contact-shop-list').html();
	
	if (sela_shops.length) sela_shops = JSON.parse(sela_shops);
	$('#contact-shop-list').html('');
	sela_shops.sela_shops.forEach(function(item){
        $.ajax({
            url: '/index.php?module=bstfprofile&action=selaShopInfo',
            dataType: 'json',
            data: {
	            shop_id: item
            },
            success: function (response) {
				shop = '<li data-shop-id="' + response.data.id + '"><button onclick="contactDeleteShop(' + response.data.id + ');" style="float:right;">x</button>' + response.data.address + '</li>';
				$('#contact-shop-list').append(shop);
            }
        });
	});
	
});
</script>	
    <form id="my-sela-shops" class="custom-input-form">
<div class="wa-form"><!-- Цвет --><div class="wa-field wa-field-fav_color"><div class="wa-name">Мой любимый цвет</div><div class="wa-value"><p><input type="text" name="color[]" value=""></p><p><input type="text" name="color[]" value=""></p><p><input type="text" name="color[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="fav-color-custom" class="custom-input-form">
<div class="wa-form"><!-- Цвет --><div class="wa-field wa-field-fav_color"><div class="wa-name">Мой любимый цвет</div><div class="wa-value"><p><input type="text" name="color[]" value=""></p><p><input type="text" name="color[]" value=""></p><p><input type="text" name="color[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-hobbies-custom">
<div class="wa-form"><!-- Хобби --><div class="wa-field wa-field-hobbies"><div class="wa-name">Мои хобби</div><div class="wa-value"><p><input type="text" name="hobbies[]" value=""></p><p><input type="text" name="hobbies[]" value=""></p><p><input type="text" name="hobbies[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-pets-custom">
<div class="wa-form"><!-- Питомцы --><div class="wa-field wa-field-pets"><div class="wa-name">Мои питомцы</div><div class="wa-value"><p><input type="text" name="pets[]" value=""></p><p><input type="text" name="pets[]" value=""></p><p><input type="text" name="pets[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-heroes-custom">
<div class="wa-form"><!-- Герои --><div class="wa-field wa-field-pets"><div class="wa-name">Мои герои</div><div class="wa-value"><p><input type="text" name="heroes[]" value=""></p><p><input type="text" name="heroes[]" value=""></p><p><input type="text" name="heroes[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-clothing-custom">
<div class="wa-form"><!-- Бренды одежды --><div class="wa-field wa-field-cloth_brands"><div class="wa-name">Мои любимые бренды одежды</div><div class="wa-value"><p><input type="text" name="clothing[]" value=""></p><p><input type="text" name="clothing[]" value=""></p><p><input type="text" name="clothing[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-shoes-custom">
<div class="wa-form"><!-- Бренды обуви --><div class="wa-field wa-field-shoe_brands"><div class="wa-name">Мои любимые бренды обуви</div><div class="wa-value"><p><input type="text" name="shoes[]" value=""></p><p><input type="text" name="shoes[]" value=""></p><p><input type="text" name="shoes[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-selfcare-custom">
<div class="wa-form"><!-- магазины косметики --><div class="wa-field wa-field-cosmetic_shops"><div class="wa-name">Мои любимые магазины косметики</div><div class="wa-value"><p><input type="text" name="selfcare[]" value=""></p><p><input type="text" name="selfcare[]" value=""></p><p><input type="text" name="selfcare[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-groceries-custom">
<div class="wa-form"><!-- Магазины продуктов --><div class="wa-field wa-field-grocery_stores"><div class="wa-name">Мои любимые магазины продуктов</div><div class="wa-value"><p><input type="text" name="groceries[]" value=""></p><p><input type="text" name="groceries[]" value=""></p><p><input type="text" name="groceries[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
    <form id="my-othershops-custom">
<div class="wa-form"><!-- Другие магазины --><div class="wa-field wa-field-other_shops"><div class="wa-name">Другие любимые магазины</div><div class="wa-value"><p><input type="text" name="othershops[0]" value=""></p><p><input type="text" name="othershops[]" value=""></p><p><input type="text" name="othershops[]" value=""></p></div></div><!--/ форма --></div>
    </form>
	
	</div>

    <form action="" method="post">
    <div class="wa-form">
    
        {$form->html()}
    
        <div class="wa-field">
            <div class="wa-value">
                <input type="submit" value="[`Save`]">
            </div>
        </div>
    </div>
    </form>
	
</div>


<script type="text/javascript" src="/wa-content/js/js/jquery.maskedinput.min.js"></script>
<script type="text/javascript">
	$('input[name="profile[phone]"]').mask("+7 (999) 999-9999");
	var custom_fields;
	
	var custom_sizez = $('input[name="profile[my_sizes]"]').val();
	if (custom_sizez.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_sizez);
	    $('form#my-sizes-custom select[name="size_top"]').val(custom_fields.size_top);
	    $('form#my-sizes-custom select[name="size_low"]').val(custom_fields.size_low);
	}
	$('form#my-sizes-custom select').on('change', function(){
		$('input[name="profile[my_sizes]"]').val($('form#my-sizes-custom').serializeJSON());
	});
	
	var custom_stylez = $('input[name="profile[fav_style]"]').val();
	if (custom_stylez.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_stylez);
		custom_fields.style.forEach(function(entry) {
		    $('form#fav-style-custom select:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#fav-style-custom select').on('change', function(){
		$('input[name="profile[fav_style]"]').val($("form#fav-style-custom :input[value!='']").serializeJSON());
	});
	
	var custom_color = $('input[name="profile[fav_color]"]').val();
	if (custom_color.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_color);
		custom_fields.color.forEach(function(entry) {
		    $('form#fav-color-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#fav-color-custom input').on('change', function(){
		$('input[name="profile[fav_color]"]').val($("form#fav-color-custom :input[value!='']").serializeJSON());
	});
		
	var custom_hobbies = $('input[name="profile[hobbies]"]').val();
	if (custom_hobbies.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_hobbies);
		custom_fields.hobbies.forEach(function(entry) {
		    $('form#my-hobbies-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-hobbies-custom input').on('change', function(){
		$('input[name="profile[hobbies]"]').val($("form#my-hobbies-custom :input[value!='']").serializeJSON());
	});
		
	var custom_pets = $('input[name="profile[pets]"]').val();
	if (custom_pets.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_pets);
		custom_fields.pets.forEach(function(entry) {
		    $('form#my-pets-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-pets-custom input').on('change', function(){
		$('input[name="profile[pets]"]').val($("form#my-pets-custom :input[value!='']").serializeJSON());
	});
		
	var custom_heroes = $('input[name="profile[heroes]"]').val();
	if (custom_heroes.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_heroes);
		custom_fields.heroes.forEach(function(entry) {
		    $('form#my-heroes-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-heroes-custom input').on('change', function(){
		$('input[name="profile[heroes]"]').val($("form#my-heroes-custom :input[value!='']").serializeJSON());
	});
		
	var custom_cloths = $('input[name="profile[cloth_brands]"]').val();
	if (custom_cloths.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_cloths);
		custom_fields.clothing.forEach(function(entry) {
		    $('form#my-clothing-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-clothing-custom input').on('change', function(){
		$('input[name="profile[cloth_brands]"]').val($("form#my-clothing-custom :input[value!='']").serializeJSON());
	});
		
	var custom_shoes = $('input[name="profile[shoe_brands]"]').val();
	if (custom_shoes.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_shoes);
		custom_fields.shoes.forEach(function(entry) {
		    $('form#my-shoes-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-shoes-custom input').on('change', function(){
		$('input[name="profile[shoe_brands]"]').val($("form#my-shoes-custom :input[value!='']").serializeJSON());
	});
		
	var custom_selfcare = $('input[name="profile[cosmetic_shops]"]').val();
	if (custom_selfcare.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_selfcare);
		custom_fields.selfcare.forEach(function(entry) {
		    $('form#my-selfcare-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-selfcare-custom input').on('change', function(){
		$('input[name="profile[cosmetic_shops]"]').val($("form#my-selfcare-custom :input[value!='']").serializeJSON());
	});
		
	var custom_groceries = $('input[name="profile[grocery_stores]"]').val();
	if (custom_groceries.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_groceries);
		custom_fields.groceries.forEach(function(entry) {
		    $('form#my-groceries-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-groceries-custom input').on('change', function(){
		$('input[name="profile[grocery_stores]"]').val($("form#my-groceries-custom :input[value!='']").serializeJSON());
	});
		
	var custom_othershops = $('input[name="profile[other_shops]"]').val();
	if (custom_othershops.length > 2) {
		var i = 0;
		custom_fields = JSON.parse(custom_othershops);
		custom_fields.othershops.forEach(function(entry) {
		    $('form#my-othershops-custom input:eq(' + i + ')').val(entry);
		    i++;
		});
	}
	$('form#my-othershops-custom input').on('change', function(){
		$('input[name="profile[other_shops]"]').val($("form#my-othershops-custom :input[value!='']").serializeJSON());
	});
	
	function contactDeleteShop(id) {
		if (confirm('Удалить магазин?')) {
	        $.ajax({
	            url: '/index.php?module=bstfprofile&action=deleteShop',
	            dataType: 'json',
	            data: {
		            shop_id: id
	            },
	            success: function (response) {
					if(response.data == true) {
						$('#contact-shop-list li[data-shop-id="' + id + '"]').remove();
					}
	            }
	        });
		}
	}
	
	function contactAddShop(id) {
        $.ajax({
            url: '/index.php?module=bstfprofile&action=addShop',
            dataType: 'json',
            data: {
	            shop_id: id
            },
            success: function (response) {
	            if(response.data > 1) {
			        $.ajax({
			            url: '/index.php?module=bstfprofile&action=selaShopInfo',
			            dataType: 'json',
			            data: {
				            shop_id: id
			            },
			            success: function (response) {
							shop = '<li data-shop-id="' + response.data.id + '"><button onclick="contactDeleteShop(' + response.data.id + ');" style="float:right;">x</button>' + response.data.address + '</li>';
							$('#contact-shop-list').append(shop);
			            }
			        });
	            }
            }
        });
	}
	
</script>

<script src="/wa-data/public/shop/themes/comfortbuy/jquery.serialize-object.min.js" type="text/javascript">
</script>

<script type="text/javascript">
/*
	$( ".wa-field-my_sizes-size_top" ).addClass('clearfix');
	$( ".wa-field-fav_color, .wa-field-hobbies, .wa-field-pets, .wa-field-cloth_brands, .wa-field-shoe_brands, .wa-field-cosmetic_shops, .wa-field-grocery_stores" ).each(function(){ multiField(this); });	
	$( ".wa-field-fav_style" ).each(function(){ multiSelectField(this); });	
	
	function addField(href) {
		var p = $('p', $(href).parent()).last();
		var input = $('input', p);
		if ($(input).val()=='') {
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300);
			return false;
		}
		var last_index = -1;
		var fname = $(input).attr('name');
		if (fname.indexOf("][") > -1) {
			last_index = fname.slice(fname.lastIndexOf("][")+2, fname.lastIndexOf("]"));
		}
		
		if (last_index == -1) {
			last_index = 0;
			input.attr('name', fname + '[0]');
		}
		
		last_index++;
		$(p).before($(p).clone());
		input.attr('value', '');
		input.focus();
		fname = $(input).attr('name').slice(0,-3);
		input.attr('name', fname + '[' + last_index + ']');
	}
	
	function addSelectField(href) {
		var p = $('p', $(href).parent()).last();
		var input = $('select', p);
		if ($(input).val()=='') {
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300);
			return false;
		}
		var last_index = -1;
		var fname = $(input).attr('name');
		if (fname.indexOf("][") > -1) {
			last_index = fname.slice(fname.lastIndexOf("][")+2, fname.lastIndexOf("]"));
		}
		
		if (last_index == -1) {
			last_index = 0;
			input.attr('name', fname + '[0]');
		}
		
		last_index++;
		$(p).before($(p).clone());
		input.attr('value', '');
		input.focus();
		fname = $(input).attr('name').slice(0,-3);
		input.attr('name', fname + '[' + last_index + ']');
	}
	
	function removeField(href) {
		var p = $(href).parent();
		var wa_value = $(p).parent();
		var other_ps = $(p).siblings('p');
		if (other_ps.length == 0) {
			var input = $('input', p);
			input.attr('value', '');
			input.addClass('wa-error');
			setTimeout(function(){ input.removeClass('wa-error', 200, "easeInBack");},300)
			return false;
		}

		p.remove();
		enumerateInputs(wa_value);
	}
	
	function enumerateInputs(wa_value) {
		var i = 0;
		var inputs = $('input', wa_value);
		inputs.each(function(){
			fname = $(this).attr('name').slice(0,-3);
			$(this).attr('name', fname + '[' + i + ']');
			if( $(this).val()=='' ) {
				$(this).parent().remove();
				i--;
			}
			i++;
		})
	}
	
	function multiField(field) {
		var wa_value = $('.wa-value', field).first();
		var inputs = $('input', wa_value);
		var last_input = $('input', wa_value).last();
		
		wa_value.append('<a onclick="addField(this);">добавить поле</a>');

		inputs.each(function(){
			$(this).before('<a style="float:right;" onclick="removeField(this);"><i class="icon-remove"></i></a>')
		});
	}

	function multiSelectField(field) {
		var wa_value = $('.wa-value', field).first();
		var inputs = $('select', wa_value);
		var last_input = $('input', wa_value).last();
		
		wa_value.append('<a onclick="addSelectField(this);">добавить поле</a>');

		inputs.each(function(){
			$(this).before('<a style="float:right;" onclick="removeField(this);"><i class="icon-remove"></i></a>')
		});
	}
	
*/
</script>
