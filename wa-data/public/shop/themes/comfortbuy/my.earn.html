<link href="{$wa_theme_url}my.earn.css" rel="stylesheet" type="text/css">
<script charset="utf-8" type="text/javascript" src="{$wa_url}wa-content/js/sailplay-hub/sailplay_hub.min.js"></script>
<div class="sidebar left230px">
    {include file="sidebar.html"}
</div>

<div class="content left230px">

    <!-- navigation breadcrumbs -->
    <div class="breadcrumbs">
        <a href="{$wa_app_url}">[`Home`]</a> » <a href="{$wa->getUrl('/frontend/my')}">[`My Account`]</a> » <span class="gray">[`My account`]</span>
    </div>
    
    <div class="info-page menu">{$wa->myNav()}</div>
   
    <h1>Список заданий</h1>
    <div id="actions-wrapper" class="actions-wrapper">
	    <p class="myriad">Выполняйте задания и получайте за них дополнительные баллы</p>
	    <ul id="actions-list" class="actions-list">
	    </ul>
    </div>
    
<script>
SAILPLAY.send('init', { partner_id: 1127 }); //инициируем модуль для партнера с айди = 206

SAILPLAY.on('init.success', function(){ //после успешной инициализации
	SAILPLAY.send('login', '{$sp_user_auth_hash}'); //авторизуем пользователя
});

SAILPLAY.on('login.success', function(){ //после успешной авторизации
	SAILPLAY.send('load.user.info'); //загружаем данные пользователя
	SAILPLAY.send('load.user.history'); //загружаем историю действий пользователя
	SAILPLAY.send('load.gifts.list'); //загружаем список подарков
	SAILPLAY.send('load.badges.list'); //загружаем список бейджиков
	SAILPLAY.send('load.actions.list'); //загружаем список действий
});

SAILPLAY.on('load.actions.list.success', function(data){ //после загрузки списка действий
	var actions = data.actions;
	function humanSN(social_network) {
		switch(social_network) {
		    case "vk": return "Вконтакте";
		    case "fb": return "Facebook";
		    case "tw": return "Twitter";
		    case "ok": return "Одноклассиках";
		}
	}
	function humanAction(api_action) {
		switch(api_action) {
		    case "like": return "Вступить в группу ";
		    case "purchase": return "Рассказать о покупке в ";
		    case "partner_page": return "Рассказать о SELA в ";
		}
	}
	for (i = 0; i < actions.length; ++i) {
		action = data.actions[i];
		
		var node = document.createElement("LI");
		node.className = "action";
	
		var divac = document.createElement("div");
		divac.className = "action-card";
	
		var pnode = document.createElement("p");
		pnode.className = "myriad";
		pnode.appendChild(document.createTextNode(humanAction(action.action) + humanSN(action.socialType)));
		
		var divap = document.createElement("div");
		divap.className = "action-points";
		divap.appendChild(document.createTextNode(action.points));
	
		var divsl = document.createElement("div");
		divsl.className = "social-logo " + action.action + " " + action.socialType;

		divac.appendChild(divsl);
		divac.appendChild(divap);
		divac.appendChild(pnode);
		node.appendChild(divac);
		document.getElementById("actions-list").appendChild(node);
	
		(function(){
			var act = action;
			divac.addEventListener('click', function() {  SAILPLAY.send('actions.perform', act); }, false);
		}());
	}
});
</script>	
</div>
